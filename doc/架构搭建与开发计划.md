# 实时同步音乐播放系统 - 架构搭建与开发计划

## 项目初始化

### 目录结构设计

```
Resonance/
├── backend/                    # Python后端
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py            # FastAPI应用入口
│   │   ├── config.py          # 配置文件
│   │   ├── models/            # 数据模型
│   │   │   ├── __init__.py
│   │   │   └── room.py        # 房间模型
│   │   ├── services/          # 业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── audio_service.py    # 音频处理服务
│   │   │   └── room_service.py     # 房间管理服务
│   │   ├── socket_handlers/    # Socket.IO事件处理
│   │   │   ├── __init__.py
│   │   │   └── music_events.py
│   │   └── utils/             # 工具函数
│   │       ├── __init__.py
│   │       └── audio_utils.py
│   ├── requirements.txt       # Python依赖
│   ├── .env                  # 环境变量
│   └── run.py               # 启动脚本
├── frontend/                  # React前端
│   ├── public/
│   ├── src/
│   │   ├── components/       # React组件
│   │   │   ├── AudioPlayer.tsx
│   │   │   ├── RoomControls.tsx
│   │   │   └── UserList.tsx
│   │   ├── services/         # API服务
│   │   │   ├── socket.ts
│   │   │   └── api.ts
│   │   ├── hooks/            # 自定义Hooks
│   │   │   └── useSocket.ts
│   │   ├── store/            # 状态管理
│   │   │   └── musicStore.ts
│   │   ├── types/            # TypeScript类型定义
│   │   │   └── music.ts
│   │   ├── App.tsx
│   │   └── index.tsx
│   ├── package.json
│   └── tsconfig.json
├── doc/                      # 文档
│   ├── 需求分析与技术选型.md
│   └── 架构搭建与开发计划.md
├── music/                    # 音频文件存储
│   └── sample.mp3
├── README.md
└── .gitignore
```

## 第一阶段：基础框架搭建（MVP）

### 目标
实现最简单的音频Socket共享播放功能，验证技术可行性。

### 后端开发步骤

#### 1. 环境准备
- 创建Python虚拟环境
- 安装FastAPI、uvicorn、python-socketio等依赖
- 配置基础项目结构

#### 2. 基础FastAPI应用搭建
- 创建FastAPI应用入口文件
- 配置Socket.IO服务器
- 设置静态文件服务（音频文件）
- 添加基础路由和健康检查

#### 3. 房间状态管理实现
- 设计RoomState数据类
- 实现RoomManager内存管理器
- 提供房间创建、更新、用户管理功能
- 实现房间状态持久化逻辑

#### 4. Socket事件处理器开发
- 实现客户端连接/断开处理
- 开发房间加入/离开事件
- 实现播放控制事件（播放、暂停、同步）
- 添加错误处理和日志记录

#### 5. 启动脚本和配置
- 创建uvicorn启动脚本
- 配置环境变量文件
- 编写requirements.txt依赖文件

### 前端开发步骤

#### 1. React项目初始化
- 创建React TypeScript项目
- 安装socket.io-client、howler等依赖
- 配置项目基础结构

#### 2. Socket通信服务开发
- 封装Socket.IO客户端服务
- 实现连接管理和事件处理
- 提供房间操作和播放控制接口

#### 3. 音频播放组件开发
- 创建AudioPlayer React组件
- 集成Howler.js音频库
- 实现播放/暂停控制
- 添加进度显示和时间同步

#### 4. 主应用组件开发
- 创建App主组件
- 集成音频播放器
- 添加房间信息显示
- 实现基础UI布局

#### 5. 样式和用户体验优化
- 添加基础CSS样式
- 优化播放器界面
- 添加响应式设计

### 集成测试

#### 1. 后端测试
- Socket.IO连接测试
- 房间管理功能测试
- 播放控制API测试

#### 2. 前端测试
- 音频播放功能测试
- Socket通信测试
- 用户界面交互测试

#### 3. 端到端测试
- 多客户端同步测试
- 播放状态一致性验证
- 网络异常处理测试

## 开发计划

### 第一阶段：基础功能验证（1-2周）
- [ ] 搭建基础项目结构
- [ ] 实现后端Socket.IO服务器
- [ ] 实现前端音频播放组件
- [ ] 完成基本的播放/暂停同步
- [ ] 测试多客户端同步效果

### 第二阶段：功能完善（2-3周）
- [ ] 添加SQLite数据库支持
- [ ] 实现用户管理功能
- [ ] 添加曲目上传和管理
- [ ] 完善房间管理功能
- [ ] 添加播放历史记录

### 第三阶段：同步优化（2-3周）
- [ ] 实现精确时间同步算法
- [ ] 添加网络延迟补偿
- [ ] 优化音频流传输
- [ ] 添加断线重连机制
- [ ] 性能优化和测试

### 第四阶段：高级功能（3-4周）
- [ ] 引入Redis支持多房间
- [ ] 添加用户认证系统
- [ ] 实现播放列表功能
- [ ] 添加音量控制
- [ ] 移动端适配

## 测试计划

### 第一阶段测试
1. **单元测试**
   - Socket事件处理测试
   - 房间状态管理测试
   - 音频播放功能测试

2. **集成测试**
   - 多客户端连接测试
   - 播放同步测试
   - 网络断线重连测试

3. **用户测试**
   - 基本播放功能测试
   - 同步效果验证
   - 用户体验测试

## 部署说明

### 开发环境启动
```bash
# 后端
cd backend
python run.py

# 前端
cd frontend
npm start
```

### 访问地址
- 前端：http://localhost:3000
- 后端API：http://localhost:8000
- Socket.IO：ws://localhost:8000

## 下一步行动
1. 创建项目目录结构
2. 安装依赖包
3. 实现后端基础框架
4. 实现前端基础组件
5. 进行基础功能测试
